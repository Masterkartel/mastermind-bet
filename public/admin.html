<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin — Mastermind Bet</title>
<style>
  body{margin:0;background:#0b0f17;color:#eaf2ff;font:14px system-ui,Segoe UI,Roboto}
  header{display:flex;gap:12px;padding:12px;background:#111a2a;border-bottom:1px solid #1a253b}
  a{color:#cfe0ff;text-decoration:none;background:#18233a;border:1px solid #243353;padding:6px 10px;border-radius:999px}
  .wrap{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px}
  .card{background:#121826;border:1px solid #1a253b;border-radius:14px;overflow:hidden}
  h2{margin:0;padding:10px 12px;background:#192235;border-bottom:1px solid #1a253b}
  .shelf{padding:12px;display:flex;flex-direction:column;gap:10px}
  input{background:#10192b;border:1px solid #263a60;color:#cfe0ff;border-radius:10px;padding:8px 10px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{background:#ffb703;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;color:#111}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #1a253b;text-align:left}
  th{color:#9eb5e4}
</style>
</head>
<body>
<header>
  <a href="/pos">POS</a><a href="/virtual">Virtual</a><a href="/history">History</a>
  <div style="margin-left:auto">Admin</div>
</header>

<div class="wrap">
  <section class="card">
    <h2>System Limits</h2>
    <div class="shelf">
      <div class="row"><label>Min Stake</label><input id="minStake" type="number" value="20"></div>
      <div class="row"><label>Max Stake</label><input id="maxStake" type="number" value="1000"></div>
      <div class="row"><label>Max Payout</label><input id="maxPayout" type="number" value="20000"></div>
      <button class="btn" id="saveLimits">Save</button>
      <div id="limMsg"></div>
    </div>
  </section>

  <section class="card">
    <h2>Agents</h2>
    <div class="shelf">
      <div class="row">
        <input id="agCode" placeholder="Code e.g. AG001">
        <input id="agName" placeholder="Name e.g. ZUKA Cashier">
        <input id="agAddBal" type="number" placeholder="Top-up e.g. 5000">
        <button class="btn" id="saveAgent">Create/Top-up</button>
      </div>
      <table id="agents"><thead><tr><th>Code</th><th>Name</th><th>Balance</th><th>Active</th></tr></thead><tbody></tbody></table>
    </div>
  </section>
</div>

<script>
async function loadLimits(){
  const r = await fetch('/admin/limits'); const j = await r.json();
  document.getElementById('minStake').value = j.min_stake;
  document.getElementById('maxStake').value = j.max_stake;
  document.getElementById('maxPayout').value = j.max_payout;
}
document.getElementById('saveLimits').onclick = async ()=>{
  const payload = {
    min_stake: Number(document.getElementById('minStake').value),
    max_stake: Number(document.getElementById('maxStake').value),
    max_payout: Number(document.getElementById('maxPayout').value),
  };
  const r = await fetch('/admin/limits',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  document.getElementById('limMsg').textContent = r.ok ? 'Saved ✅' : 'Failed';
};

async function loadAgents(){
  const r = await fetch('/admin/agents'); const list = await r.json();
  document.querySelector('#agents tbody').innerHTML = list.map(a=>
    `<tr><td>${a.code}</td><td>${a.name}</td><td>${(a.balance||0).toFixed(2)}</td><td>${a.is_active?'Yes':'No'}</td></tr>`
  ).join('');
}
document.getElementById('saveAgent').onclick = async ()=>{
  const payload = {
    code: document.getElementById('agCode').value.trim(),
    name: document.getElementById('agName').value.trim(),
    add_balance: Number(document.getElementById('agAddBal').value || 0),
  };
  const r = await fetch('/admin/agents',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  await loadAgents();
  alert(r.ok ? 'Agent updated ✅' : 'Failed');
};

loadLimits(); loadAgents();
</script>
</body>
</html>
