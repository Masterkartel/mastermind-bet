<!doctype html>
<html>
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mastermind — Virtuals</title>
<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --line:#1f2937; --text:#e2e8f0; --tile:#111827;
  --accent:#f59e0b;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Arial}
header{position:sticky;top:0;background:#0c1426;border-bottom:1px solid var(--line);padding:12px 16px;z-index:10}
h1{margin:0;font-size:18px}
.wrap{display:grid;grid-template-columns:1fr 340px;gap:12px;padding:12px}
@media(max-width:1024px){.wrap{grid-template-columns:1fr}}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px}
.tiles{display:grid;grid-template-columns:repeat(6,minmax(120px,1fr));gap:10px;margin-bottom:10px}
@media(max-width:1200px){.tiles{grid-template-columns:repeat(3,1fr)}}
@media(max-width:600px){.tiles{grid-template-columns:repeat(2,1fr)}}
.tile{cursor:pointer;border:1px solid #223048;background:var(--tile);border-radius:16px;padding:12px;display:flex;gap:10px;align-items:center;transition:transform .12s ease, box-shadow .12s ease}
.tile:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.35)}
.tile.active{outline:2px solid var(--accent)}
.tbl{width:100%;border-collapse:collapse}
.tbl th,.tbl td{border-bottom:1px solid #223048;padding:6px 8px;font-size:14px}
.btn-odd{display:inline-block;min-width:52px;text-align:center;background:#0b1528;border:1px solid #334155;border-radius:8px;padding:6px 8px;margin:2px;cursor:pointer}
.btn-odd:hover{outline:2px solid var(--accent)}
/* glossy balls */
.ball{width:38px;height:38px;border-radius:999px;display:inline-grid;place-items:center;font:700 14px/1 system-ui;color:#fff;margin-right:6px;border:1px solid rgba(0,0,0,.3);box-shadow:inset 0 -8px 14px rgba(0,0,0,.35), inset 0 10px 18px rgba(255,255,255,.12), 0 3px 8px rgba(0,0,0,.45)}
.ball-label{font-size:11px;margin-left:4px;color:#cfd6e6}
.ball.red{background:radial-gradient(circle at 30% 25%, #ff8a8a, #d71d1d 55%, #8b1111)}
.ball.green{background:radial-gradient(circle at 30% 25%, #79ffb5, #10b981 55%, #0a5e46)}
.ball.blue{background:radial-gradient(circle at 30% 25%, #8ac7ff, #2563eb 55%, #163986)}
.ball.yellow{background:radial-gradient(circle at 30% 25%, #ffe99a, #f59e0b 55%, #7a4e02)}
.tiny{font-size:12px;color:#9fb0c8}
.badge{font-size:12px;border:1px solid #2a3b60;padding:2px 6px;border-radius:999px;color:#bcd}
</style>
</head>
<body>
<header><h1>Mastermind Virtuals</h1></header>

<div class="wrap">
  <div class="panel">
    <!-- Tiles -->
    <div id="tiles" class="tiles">
      <div class="tile active" data-kind="FOOTBALL" data-code="EPL"><strong>EPL</strong></div>
      <div class="tile" data-kind="FOOTBALL" data-code="UCL"><strong>UCL</strong></div>
      <div class="tile" data-kind="FOOTBALL" data-code="LALIGA"><strong>LaLiga</strong></div>
      <div class="tile" data-kind="COLOR" data-code="COLOR">
        <div class="ball red">●</div><div class="ball green">●</div><div class="ball blue">●</div><div class="ball yellow">●</div>
        <span class="ball-label">Color Pool</span>
      </div>
      <div class="tile" data-kind="RACE" data-code="DOG"><strong>Dogs</strong></div>
      <div class="tile" data-kind="RACE" data-code="HORSE"><strong>Horses</strong></div>
    </div>

    <div id="content"></div>
  </div>

  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Fastbet</strong><button id="refresh" class="tile" style="padding:6px 10px">Refresh</button>
    </div>
    <div id="tickets" class="tiny" style="margin-top:8px">Your quick slips will appear here.</div>
  </div>
</div>

<script>
(function(){
  var $ = function(s){ return document.querySelector(s); };
  function api(u){ return fetch(u).then(function(r){ return r.json(); }); }
  function btnOdd(o,cb){
    var b=document.createElement('span');
    b.className='btn-odd';
    b.textContent=(typeof o==='number' && o.toFixed)?o.toFixed(2):o;
    b.onclick=cb; return b;
  }
  function short(x){ return String(x||'').toUpperCase().slice(0,3); }

  /* ===== Football with tabs ===== */
  function showFootball(code){
    var box=$('#content'); box.innerHTML='';

    // header line + timer to earliest kickoff in this league
    var header=document.createElement('div'); header.style.cssText='display:flex;align-items:center;gap:10px;margin:6px 0';
    header.innerHTML='<strong>League • '+code+'</strong> <span id="kickTimer" class="badge">--:--</span>';
    box.appendChild(header);

    var tabs = ['MAIN','OVER/UNDER','HOME OV/UN','AWAY OV/UN','1X2 OV/UN 1.5','1X2 OV/UN 2.5'];
    var active = 'MAIN';

    var tabBar = document.createElement('div'); tabBar.className='tiles';
    tabs.forEach(function(t){
      var el=document.createElement('div');
      el.className='tile'+(t===active?' active':'');
      el.textContent=t;
      el.onclick=function(){
        active=t;
        renderTable();
        var kids=tabBar.querySelectorAll('.tile'); for (var i=0;i<kids.length;i++) kids[i].classList.remove('active');
        el.classList.add('active');
      };
      tabBar.appendChild(el);
    });
    box.appendChild(tabBar);

    var fixtures=[];
    function nextKickTimer(){
      if(!fixtures.length) return;
      var soon = Math.min.apply(null, fixtures.map(function(f){ return new Date(f.start_time).getTime(); }));
      var el=document.getElementById('kickTimer');
      function two(n){ return String(n).padStart(2,'0'); }
      function tick(){
        var s = Math.max(0, Math.floor((soon - Date.now())/1000));
        el.textContent = two(Math.floor(s/60))+':'+two(s%60);
        setTimeout(tick, 500);
      }
      tick();
    }

    function colPrice(by, label, name){
      var a = by[label] || [];
      for (var i=0;i<a.length;i++) if (a[i].name===name) return a[i].price;
      return '-';
    }

    function renderTable(){
      var old = box.querySelector('table'); if (old) old.remove();
      var t=document.createElement('table'); t.className='tbl';
      var headerCols='';
      if (active==='MAIN') headerCols='<th>1</th><th>X</th><th>2</th><th>1X</th><th>12</th><th>X2</th><th>GG</th><th>NG</th>';
      if (active==='OVER/UNDER') headerCols='<th>OV1.5</th><th>UN1.5</th><th>OV2.5</th><th>UN2.5</th>';
      if (active==='HOME OV/UN') headerCols='<th>H OV0.5</th><th>H UN0.5</th><th>H OV1.5</th><th>H UN1.5</th><th>H OV2.5</th><th>H UN2.5</th>';
      if (active==='AWAY OV/UN') headerCols='<th>A OV0.5</th><th>A UN0.5</th><th>A OV1.5</th><th>A UN1.5</th><th>A OV2.5</th><th>A UN2.5</th>';
      if (active==='1X2 OV/UN 1.5') headerCols='<th>1+OV1.5</th><th>X+OV1.5</th><th>2+OV1.5</th><th>1+UN1.5</th><th>X+UN1.5</th><th>2+UN1.5</th>';
      if (active==='1X2 OV/UN 2.5') headerCols='<th>1+OV2.5</th><th>X+OV2.5</th><th>2+OV2.5</th><th>1+UN2.5</th><th>X+UN2.5</th><th>2+UN2.5</th>';
      t.innerHTML='<thead><tr><th>#</th><th>Match</th>'+headerCols+'</tr></thead><tbody></tbody>';
      var tb=t.querySelector('tbody');

      fixtures.forEach(function(f,idx){
        var tr=document.createElement('tr');
        tr.innerHTML='<td>'+(idx+1)+'</td><td>'+short(f.home)+' vs '+short(f.away)+'</td>';
        tb.appendChild(tr);

        fetch('/api/selections?fixture_id='+f.id).then(function(r){return r.json();}).then(function(sel){
          var by={}; for (var i=0;i<sel.length;i++){ var s=sel[i]; (by[s.label]=by[s.label]||[]).push(s); }
          function add(val){
            var td=document.createElement('td');
            td.appendChild(btnOdd(val, function(){}));
            tr.appendChild(td);
          }
          if (active==='MAIN'){
            add(colPrice(by,'1X2','Home'));
            add(colPrice(by,'1X2','Draw'));
            add(colPrice(by,'1X2','Away'));
            add(colPrice(by,'DOUBLE CHANCE','1X'));
            add(colPrice(by,'DOUBLE CHANCE','12'));
            add(colPrice(by,'DOUBLE CHANCE','X2'));
            add(colPrice(by,'GG/NG','GG'));
            add(colPrice(by,'GG/NG','NG'));
          }
          if (active==='OVER/UNDER'){
            add(colPrice(by,'OV/UN 1.5','OV1.5')); add(colPrice(by,'OV/UN 1.5','UN1.5'));
            add(colPrice(by,'OV/UN 2.5','OV2.5')); add(colPrice(by,'OV/UN 2.5','UN2.5'));
          }
          if (active==='HOME OV/UN'){
            add(colPrice(by,'HOME OV/UN 0.5','H OV0.5')); add(colPrice(by,'HOME OV/UN 0.5','H UN0.5'));
            add(colPrice(by,'HOME OV/UN 1.5','H OV1.5')); add(colPrice(by,'HOME OV/UN 1.5','H UN1.5'));
            add(colPrice(by,'HOME OV/UN 2.5','H OV2.5')); add(colPrice(by,'HOME OV/UN 2.5','H UN2.5'));
          }
          if (active==='AWAY OV/UN'){
            add(colPrice(by,'AWAY OV/UN 0.5','A OV0.5')); add(colPrice(by,'AWAY OV/UN 0.5','A UN0.5'));
            add(colPrice(by,'AWAY OV/UN 1.5','A OV1.5')); add(colPrice(by,'AWAY OV/UN 1.5','A UN1.5'));
            add(colPrice(by,'AWAY OV/UN 2.5','A OV2.5')); add(colPrice(by,'AWAY OV/UN 2.5','A UN2.5'));
          }
          if (active==='1X2 OV/UN 1.5'){
            ['1+OV1.5','X+OV1.5','2+OV1.5','1+UN1.5','X+UN1.5','2+UN1.5'].forEach(function(k){ add(colPrice(by,'1X2 OV/UN 1.5',k)); });
          }
          if (active==='1X2 OV/UN 2.5'){
            ['1+OV2.5','X+OV2.5','2+OV2.5','1+UN2.5','X+UN2.5','2+UN2.5'].forEach(function(k){ add(colPrice(by,'1X2 OV/UN 2.5',k)); });
          }
        });
      });

      box.appendChild(t);
    }

    // load fixtures then render + timer
    api('/api/fixtures?competition_code='+encodeURIComponent(code)).then(function(fx){
      fixtures = fx || [];
      renderTable();
      nextKickTimer();
    });
  }

  /* ===== Colors (simple link to POS page behavior kept) ===== */
  function showColor(){
    var box=$('#content'); box.innerHTML='';
    api('/api/colors/draws/latest').then(function(data){
      if(!data){ box.textContent='No scheduled draw.'; return; }
      var picks = data.picks || [];
      var grid=document.createElement('div');
      picks.forEach(function(p){
        var span=document.createElement('span'); span.className='btn-odd';
        var c=p.color;
        var cls=(c==='RED'?'red':(c==='GREEN'?'green':(c==='BLUE'?'blue':'yellow')));
        var dot = '<span class="ball '+cls+'">'+c.charAt(0)+'</span><span class="ball-label">'+c+'</span>';
        span.innerHTML=dot+' @ '+p.price;
        grid.appendChild(span);
      });
      box.appendChild(grid);
    });
  }

  function showRaces(type){
    var box=$('#content'); box.innerHTML='';
    api('/api/races?type='+encodeURIComponent(type)).then(function(races){
      if(!races || !races.length){ box.textContent='No races yet.'; return; }
      races.forEach(function(r){
        var wrap=document.createElement('div'); wrap.className='panel'; wrap.style.marginBottom='8px';
        wrap.innerHTML='<div><strong>'+r.track+'</strong> • R'+r.race_no+' — '+new Date(r.start_time).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})+'</div>';
        api('/api/selections?race_event_id='+r.id).then(function(sel){
          var by={}; for (var i=0;i<sel.length;i++){ var s=sel[i]; (by[s.label] ||= []).push(s); }
          Object.keys(by).forEach(function(label){
            var row=document.createElement('div'); row.style.marginTop='6px';
            row.innerHTML='<div style="margin-bottom:4px"><b>'+label+'</b></div>';
            by[label].forEach(function(s){
              row.appendChild(btnOdd(s.price,function(){}));
            });
            wrap.appendChild(row);
          });
        });
        box.appendChild(wrap);
      });
    });
  }

  function activate(el){
    var tiles=document.querySelectorAll('.tile');
    for (var i=0;i<tiles.length;i++) tiles[i].classList.remove('active');
    el.classList.add('active');
    var kind=el.getAttribute('data-kind'), code=el.getAttribute('data-code');
    if(kind==='FOOTBALL') showFootball(code);
    if(kind==='COLOR') showColor();
    if(kind==='RACE') showRaces(code);
  }

  document.getElementById('tiles').addEventListener('click', function(e){
    var t=e.target.closest('.tile'); if(!t) return; activate(t);
  });

  // initial load
  activate(document.querySelector('.tile.active'));
})();
</script>
</body>
</html>
